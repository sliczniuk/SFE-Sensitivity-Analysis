\documentclass[../Article_Sensitivity_Analsysis.tex]{subfiles}
\graphicspath{{\subfix{../Figures/}}}
\begin{document}
	
	Local derivative-based methods involve taking the total derivative of the state vector $x$ with respect to the parameter space $\Theta$. The set of derivatives, known as sensitivity equations, is integrated simultaneously with the process model. The sensitivity analysis shows how responsive the solution is for changes in the parameter $\Theta$. As discussed by \citet{Dickinson1976}, the sensitivity analysis can be used to determine the influence of the uncertainty on the solution of the original system. Another application of sensitivity analysis is to distinguish sensitive parameters from insensitive ones, which might be helpful for model reduction. Finally, from a control engineering point of view, the sensitivity analysis allows sorting the control variables with respect to the level of effort required to change the model's output.
	
	Following the work of \citet{Maly1996}, the sensitivity equations can be defined as follow:
	
	{\footnotesize
		\begin{equation}
			\label{SA_def}
			S(x;\Theta) = \cfrac{dx}{d\Theta}
	   \end{equation} }
	
	The new system of equations can be obtained by taking the total derivative of $S$ with respect to time $t$.
	
	{\footnotesize
		\begin{equation} \label{SA_dt} 
			{\dot{S}}(x;\Theta)  = \cfrac{dS(x;\Theta)}{d t} = \cfrac{d}{d t} \left( \cfrac{dx}{d\Theta} \right) = \cfrac{d }{d\Theta} \left( \cfrac{dx}{d t} \right) = \cfrac{d G(x;\Theta)}{d\Theta} 
	\end{equation} }
	
	The sensitivity Equation \ref{SA_eq_full} can be obtained by applying the definition of the total derivative to Equation \ref{SA_dt}.
	
	{\footnotesize
		\begin{equation} \label{SA_eq_full}
			\cfrac{d G(x;\Theta)}{d \Theta} = \underbrace{ \cfrac{\partial G(x;\Theta)}{\partial x} }_{{\bar{J}_x}(x;\Theta)} \underbrace{\cfrac{\partial x}{\partial \Theta} }_{\bar{S}(x;\Theta)} + \underbrace{ \cfrac{\partial G(x;\Theta)}{\partial \Theta} }_{{\bar{J}_\Theta}(x;\Theta)}
	  \end{equation} }
	
	The Jacobian ${\bar{J}_x}(x;\Theta)$ represents the matrix of equations of size $N_x \times N_x$, where each equation ${\bar{J}_x}(n_x,n_x)$ is the derivative of $G_{n_x}(x;\Theta)$ with respect to the state variable $x_{n_\Theta}$.
	
	{\footnotesize
		\begin{align}
			\begingroup % keep the change local
			\setlength\arraycolsep{2pt}
			{\bar{J}_x}(x;\Theta)=\begin{pmatrix}
				\cfrac{\partial {G_{1}}(x;\Theta)}{\partial {x_{1}}} & \cfrac{\partial {G_{1}}(x;\Theta)}{\partial {x_{2}}} & \cdots & \cfrac{\partial {G_{1}}(x;\Theta)}{\partial {x_{N_x}}}\\
				\cfrac{\partial {G_{2}}(x;\Theta)}{\partial {x_{1}}} & \cfrac{\partial {G_{2}}(x;\Theta)}{\partial {x_{2}}} & \cdots & \cfrac{\partial {G_{2}}(x;\Theta)}{\partial {x_{N_x}}}\\
				\vdots & \vdots & \ddots & \vdots\\ 
				\cfrac{\partial {G_{N_x}}(x;\Theta)}{\partial {x_{1}}} & \cfrac{\partial {G_{N_x}}(x;\Theta)}{\partial {x_{2}}} & \cdots & \cfrac{\partial {G_{N_x}}(x;\Theta)}{\partial {x_{N_x}}}\\
			\end{pmatrix}
			\endgroup
	\end{align} }
	
	The sensitivity matrix $\bar{S}(x;\Theta)$ represents the matrix of equations of size $N_x \times N_\Theta$, where each entry $\bar{S}(n_x,n_\Theta)$ is the derivative of the state variable $x_{n_x}$ with respect to the parameter $\Theta_{n_\Theta}$. Matrix ${\bar{J}_x}(x;\Theta)$ and $\bar{S}(x;\Theta)$ describe indirect influence of $\Theta_{n_\Theta}$ on the state space.
	
	{\footnotesize
		\begin{equation}
			\begin{split}
				\bar{S}(x;\Theta) & = 
				\begingroup % keep the change local
				\setlength\arraycolsep{2pt}
				\begin{pmatrix}
					\cfrac{\partial {x_{1}}}{\partial {\Theta_{1}}} 	& \cfrac{\partial {x_{1}}}{d {\Theta_{2}}}     & \cdots & \cfrac{d {x_{1}}}{\partial {\Theta_{N_\Theta}}}\\
					\cfrac{\partial {x_{2}}}{\partial {\Theta_{1}}} 	& \cfrac{\partial {x_{2}}}{d {\Theta_{2}}}     & \cdots & \cfrac{d {x_{2}}}{\partial {\Theta_{N_\Theta}}}\\
					\vdots					 	    & \vdots 					   	  & \ddots & \vdots\\
					\cfrac{\partial {x_{N_x}}}{\partial {\Theta_{1}}} 	& \cfrac{\partial {x_{N_x}}}{d {\Theta_{2}}}     & \cdots & \cfrac{\partial {x_{N_x}}}{d {\Theta_{N_\Theta}}}
				\end{pmatrix} 
				\endgroup
			\end{split}
	\end{equation} }
	
	The Jacobian ${\bar{J}_\Theta}(x;\Theta)$ represents the matrix of equations of size $N_x \times N_\Theta$, where each subequation ${\bar{J}_\Theta}(n_x,n_\Theta)$ is the partial derivative of the process model equation $G_{n_x}$ with respect to the parameter $\Theta_{n_\Theta}$. ${\bar{J}_\Theta}(n_x,n_\Theta)$ defines direct effect of $\Theta_{n_\Theta}$ on the state space.
	
	{\footnotesize
		\begin{align}
			{\bar{J}_\Theta}(x;\Theta) & =
			\begingroup % keep the change local
			\setlength\arraycolsep{2pt}
			\begin{pmatrix}
				\cfrac{\partial {G_{1}}(x;\Theta)}{\partial {\Theta_{1}}} & \cfrac{\partial {G_{1}}(x;\Theta)}{\partial {\Theta_{2}}} & \cdots & \cfrac{\partial {G_{1}}(x;\Theta)}{\partial {\Theta_{N_\Theta}}}\\
				\cfrac{\partial {G_{2}}(x;\Theta)}{\partial {\Theta_{1}}} & \cfrac{\partial {G_{2}}(x;\Theta)}{\partial {\Theta_{2}}} & \cdots & \cfrac{\partial {G_{2}}(x;\Theta)}{\partial {\Theta_{N_\Theta}}}\\
				\vdots & \vdots & \ddots & \vdots\\
				\cfrac{\partial {G_{N_x}}(x;\Theta)}{\partial {\Theta_{1}}} & \cfrac{\partial {G_{N_x}}(x;\Theta)}{\partial {\Theta_{2}}} & \cdots & \cfrac{\partial {G_{N_x}}(x;\Theta)}{\partial {\Theta_{N_\Theta}}}
			\end{pmatrix}
			\endgroup
	\end{align}}
	
	The augmented system containing the original set of equations $G(x;\Theta)$ and sensitivity equations can be formulated as ${\textbf{G}}\left(x;\Theta\right)$. The size of ${\textbf{G}}\left(x;\Theta\right)$ is equal to $N_s = N_x(N_\Theta + 1)$.
	
	{\footnotesize
		\begin{align}
			{\textbf{G}}\left(x;\Theta\right) = 
			\begin{bmatrix}
				G(x;\Theta)\\
				{\bar{J}_x}(x;\Theta)\bar{S}(x;\Theta) + {\bar{J}_\Theta}(x;\Theta)
			\end{bmatrix}
	\end{align} }
	
	The initial conditions are described as
	
	{\footnotesize
		\begin{align}
			{\textbf{G}}\left(x(t_0);\Theta\right)  &= 
			\begin{bmatrix}
                x(t_0),						               &
				\cfrac{ \text{d}x(t_0) }{ d{\Theta_1} },		   &
				\cdots,					 				   &
				\cfrac{ dx(t_0) }{ d{\Theta_{N_\Theta}} }            
			\end{bmatrix}^\top = \\ &=
            \begin{bmatrix} 
                \quad x_0,	                               &
				\quad ~0,		                           &
			    \quad \cdots,			                   &
				\quad 0 \quad~~
			\end{bmatrix}^\top
	\end{align} }
	
	The sensitivity analysis of the output function can be performed with respect to parameters $\Theta$. The output function $g(x)$ returns ${y}$. By taking a total derivative of ${y}$ with respect to $\Theta$, the new sensitivity equation can be found.
	
	{\footnotesize
		\begin{equation}
			\cfrac{d {y}}{d\Theta} = \cfrac{d g(x)}{d\Theta} = \cfrac{\partial g(x)}{\partial x} \cfrac{\partial x}{\partial \Theta} + \cfrac{\partial g(x)}{\partial \Theta}
	   \end{equation} }
	
\end{document}